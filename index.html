<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web-basierte Anwendungssysteme - Quiz</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Press Start 2P', cursive;
        }

        body {
            background: #2c3440;
            background-image: 
                linear-gradient(45deg, #1a202c 25%, transparent 25%),
                linear-gradient(-45deg, #1a202c 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #1a202c 75%),
                linear-gradient(-45deg, transparent 75%, #1a202c 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            min-height: 100vh;
            padding: 20px;
            color: #fff;
            transition: background 0.5s ease;
            image-rendering: pixelated;
            line-height: 1.6;
            overflow-x: hidden;
            max-width: 100vw;
            box-sizing: border-box;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(
                circle at 50% 50%,
                rgba(66, 153, 225, 0.1) 0%,
                rgba(26, 32, 44, 0.4) 100%
            );
            pointer-events: none;
            z-index: 1;
        }

        body.level-easy {
            background: #143321;
            background-image: linear-gradient(45deg, #143321 25%, #0f2819 25%, #0f2819 50%, #143321 50%, #143321 75%, #0f2819 75%, #0f2819 100%);
            background-size: 20px 20px;
        }

        body.level-medium {
            background: #4a3810;
            background-image: linear-gradient(45deg, #4a3810 25%, #3a2a0c 25%, #3a2a0c 50%, #4a3810 50%, #4a3810 75%, #3a2a0c 75%, #3a2a0c 100%);
            background-size: 20px 20px;
        }

        body.level-hard {
            background: #4a1010;
            background-image: linear-gradient(45deg, #4a1010 25%, #3a0c0c 25%, #3a0c0c 50%, #4a1010 50%, #4a1010 75%, #3a0c0c 75%, #3a0c0c 100%);
            background-size: 20px 20px;
        }

        body.level-expert {
            background: #1a1a4a;
            background-image: linear-gradient(45deg, #1a1a4a 25%, #14143a 25%, #14143a 50%, #1a1a4a 50%, #1a1a4a 75%, #14143a 75%, #14143a 100%);
            background-size: 20px 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: linear-gradient(135deg, #2c3e50, #3498db);
            border: 4px solid #fff;
            position: relative;
            image-rendering: pixelated;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            border-radius: 12px;
        }

        .container::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border: 4px solid rgba(255,255,255,0.2);
            pointer-events: none;
            border-radius: 12px;
        }

        .container::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid rgba(255,255,255,0.1);
            pointer-events: none;
            border-radius: 12px;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #2980b9);
            color: #fff;
            padding: 20px;
            text-align: center;
            position: relative;
            border-bottom: 4px solid rgba(255,255,255,0.2);
            image-rendering: pixelated;
            border-radius: 8px 8px 0 0;
        }

        .level-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #000;
            padding: 8px;
            border: 2px solid #fff;
            font-size: 8px;
            image-rendering: pixelated;
            text-transform: uppercase;
            color: #7FFF00;
            text-shadow: 2px 2px #000;
        }

        .xp-container {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #000;
            padding: 8px;
            border: 2px solid #fff;
            font-size: 8px;
            image-rendering: pixelated;
            color: #FFD700;
            text-shadow: 2px 2px #000;
        }

        .header h1 {
            font-size: 16px;
            margin: 15px 0;
            text-transform: uppercase;
            color: #FFD700;
            text-shadow: 2px 2px #000,
                         -2px 2px #000,
                         2px -2px #000,
                         -2px -2px #000;
            letter-spacing: 1px;
        }

        .progress-container {
            background: #000;
            border: 2px solid #fff;
            height: 20px;
            margin-top: 20px;
            position: relative;
            image-rendering: pixelated;
        }

        .progress-bar {
            height: 100%;
            background: #4169E1;
            transition: width 0.3s step-end;
            position: relative;
            image-rendering: pixelated;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 5px,
                rgba(255,255,255,0.1) 5px,
                rgba(255,255,255,0.1) 10px
            );
            animation: progressStripes 0.5s linear infinite;
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 2s infinite;
            overflow: hidden;
        }
        
        @keyframes glowing {
            0% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
            50% { box-shadow: 0 0 35px rgba(255, 215, 0, 1); }
            100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
        }
        
        @keyframes progressPulse {
            0% { opacity: 0.85; }
            50% { opacity: 1; }
            100% { opacity: 0.85; }
        }

        @keyframes gradientMove {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 0%; }
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .content {
            padding: 30px;
            background: rgba(0,0,0,0.3);
            border-radius: 0 0 8px 8px;
        }

        .question-container {
            display: none;
        }

        .question-container.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes levelUp {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
            100% { transform: scale(1) rotate(360deg); opacity: 1; }
        }

        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .level-up-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        .level-up-overlay.show {
            display: flex;
        }

        .level-up-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            animation: levelUp 0.8s ease;
        }

        .level-up-content h2 {
            font-size: 32px;
            margin-bottom: 20px;
            color: #667eea;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 999;
            animation: confetti 3s ease-out;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .question-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        .difficulty-indicator {
            display: flex;
            gap: 5px;
        }

        .difficulty-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #e2e8f0;
        }

        .difficulty-dot.active {
            background: #667eea;
        }

        .question-text {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 25px;
            line-height: 1.6;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            border: 2px solid rgba(255,255,255,0.3);
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            margin-bottom: 8px;
            color: #fff;
            font-size: 12px;
            text-shadow: 1px 1px rgba(0,0,0,0.5);
            image-rendering: pixelated;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .option::before {
            content: attr(data-letter);
            width: 24px;
            height: 24px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            flex-shrink: 0;
            margin-right: 8px;
            color: #fff;
        }

        .option:hover {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .option.selected {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: #fff;
            border-color: rgba(255,255,255,0.8);
        }

        .option.selected::before {
            border-color: #fff;
            color: #fff;
            background: rgba(255,255,255,0.2);
        }

        .option.correct {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: #fff;
            border-color: #fff;
            animation: pixelPulse 0.5s ease;
        }

        .option.correct::before {
            border-color: #fff;
            color: #fff;
            background: rgba(255,255,255,0.3);
        }

        .option.wrong {
            background: linear-gradient(135deg, #c0392b, #e74c3c);
            color: #fff;
            border-color: rgba(255,255,255,0.5);
            animation: pixelShake 0.5s ease;
        }

        .option.wrong::before {
            border-color: #FF6347;
            color: #FF6347;
        }

        @keyframes pixelPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes pixelShake {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(-2px, 0); }
            75% { transform: translate(2px, 0); }
        }

        @keyframes progressStripes {
            from { background-position: 0 0; }
            to { background-position: 20px 0; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .text-input, .blank-input, .name-input {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.1);
            color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .blank-input {
            display: inline-block;
            width: 200px;
            margin: 0 5px;
        }

        .text-input:focus,
        .blank-input:focus,
        .name-input:focus {
            outline: none;
            border-color: #3498db;
            background: rgba(255,255,255,0.15);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .text-input::placeholder,
        .blank-input::placeholder,
        .name-input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .sortable-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .sortable-item {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            cursor: move;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sortable-item:hover {
            background: #edf2f7;
            transform: translateX(5px);
        }

        .sortable-item.dragging {
            opacity: 0.5;
        }

        .drag-handle {
            cursor: move;
            font-size: 20px;
            color: #a0aec0;
        }

        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .matching-column {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .matching-item {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .matching-item:hover {
            background: #edf2f7;
            border-color: #667eea;
        }

        .matching-item.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 12px 24px;
            border: none;
            background: linear-gradient(135deg, #3498db, #2980b9);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            color: #fff;
            text-transform: uppercase;
            margin: 4px;
            image-rendering: pixelated;
            position: relative;
            text-shadow: 1px 1px rgba(0,0,0,0.3);
            font-family: 'Press Start 2P', cursive;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-width: 120px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: #fff;
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #2980b9, #2573a7);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: #fff;
        }

        .btn-secondary:hover:not(:disabled) {
            background: linear-gradient(135deg, #7f8c8d, #6c7a7d);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            background: #95a5a6;
        }

        .btn:active:not(:disabled) {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 12px;
            display: none;
        }

        .feedback.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        .feedback.correct {
            background: #c6f6d5;
            color: #22543d;
            border: 2px solid #48bb78;
        }

        .feedback.wrong {
            background: #fed7d7;
            color: #742a2a;
            border: 2px solid #f56565;
        }

        .feedback.warning {
            background: #fffbea;
            color: #744210;
            border: 2px solid #f6e05e;
        }

        .xp-gain {
            display: inline-block;
            background: #ffd700;
            color: #000;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
            animation: pulse 0.5s;
        }

        .result-container {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .result-container.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.4);
        }

        .score-text {
            color: white;
            font-size: 48px;
            font-weight: bold;
        }

        .result-message {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .result-details {
            color: #fff;
            font-size: 18px;
            margin-bottom: 30px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.6);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 8px;
        }

        .start-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .start-screen h2 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .start-screen p {
            color: #fff;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 30px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
        }

        .player-name-wrapper {
            max-width: 400px;
            margin: 0 auto 20px;
            text-align: left;
        }

        .player-name-label {
            font-size: 14px;
            font-weight: 500;
            color: #fff;
            margin-bottom: 8px;
            display: block;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .level-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .level-card {
            background: #f4e4bc;
            background-image: 
                linear-gradient(45deg, rgba(0,0,0,0.03) 25%, transparent 25%, transparent 75%, rgba(0,0,0,0.03) 75%),
                linear-gradient(45deg, rgba(0,0,0,0.03) 25%, transparent 25%, transparent 75%, rgba(0,0,0,0.03) 75%);
            background-size: 4px 4px;
            padding: 15px;
            margin: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            flex: 1;
            min-width: 150px;
            max-width: 300px;
            position: relative;
            color: #2c1810;
            border: 1px solid #8b4513;
            box-shadow: 
                2px 2px 5px rgba(0,0,0,0.2),
                inset 0 0 30px rgba(139,69,19,0.2);
            transform: rotate(-1deg);
            word-wrap: break-word;
            overflow: hidden;
        }

        .level-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 1px solid rgba(139,69,19,0.3);
            background: transparent;
            pointer-events: none;
        }

        .level-card::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(139,69,19,0.1) 2px,
                    rgba(139,69,19,0.1) 4px
                );
            pointer-events: none;
            z-index: 1;
        }

        .level-card:hover {
            transform: rotate(1deg) translateY(-5px);
            box-shadow: 
                4px 4px 10px rgba(0,0,0,0.3),
                inset 0 0 30px rgba(139,69,19,0.3);
        }

        .level-card.selected {
            background: #ffe4b5;
            transform: rotate(0deg) scale(1.05);
            box-shadow: 
                0 0 20px rgba(255,215,0,0.3),
                inset 0 0 30px rgba(139,69,19,0.4);
            border-color: #8b4513;
        }

        .level-icon {
            font-size: 32px;
            margin-bottom: 16px;
            position: relative;
            z-index: 2;
        }

        .level-name {
            font-size: 12px;
            font-family: 'Press Start 2P', cursive;
            margin-bottom: 12px;
            color: #4a1810;
            position: relative;
            z-index: 2;
            text-shadow: 1px 1px rgba(255,255,255,0.5);
            word-wrap: break-word;
            hyphens: auto;
        }

        .level-description {
            font-size: 10px;
            color: #5c2811;
            font-family: 'Press Start 2P', cursive;
            position: relative;
            z-index: 2;
            line-height: 1.4;
            text-shadow: 1px 1px rgba(255,255,255,0.5);
            word-wrap: break-word;
            hyphens: auto;
        }

        .share-box {
            background: #f7fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 16px;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
            font-size: 14px;
            color: #4a5568;
        }

        .share-hint {
            font-size: 13px;
            color: #718096;
            margin-top: 8px;
        }

        .btn-whatsapp {
            background: #25D366;
            color: #fff;
        }

        .btn-whatsapp:hover {
            box-shadow: 0 10px 20px rgba(37,211,102,0.4);
            transform: translateY(-2px);
        }

        .mode-selection {
            margin: 20px 0;
            text-align: center;
        }
        
        .mode-selection label {
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .mode-btn {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .timer-display {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            backdrop-filter: blur(10px);
            color: white;
        }

        .leaderboard {
            background: #f7fafc;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .leaderboard-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2d3748;
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
        }

        .leaderboard-entry:last-child {
            border-bottom: none;
        }

        .entry-name {
            font-weight: 500;
        }

        .entry-score {
            color: #667eea;
            font-weight: bold;
        }

        .entry-time {
            color: #718096;
            font-size: 14px;
        }

        .mode-btn {
            background: #fff;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            min-width: 150px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.2);
        }

        .mode-btn.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .session-leaderboard {
            background: #4a3810;
            background-image: 
                linear-gradient(30deg, #2a1f0d 12%, transparent 12.5%, transparent 87%, #2a1f0d 87.5%, #2a1f0d),
                linear-gradient(150deg, #2a1f0d 12%, transparent 12.5%, transparent 87%, #2a1f0d 87.5%, #2a1f0d),
                linear-gradient(30deg, #2a1f0d 12%, transparent 12.5%, transparent 87%, #2a1f0d 87.5%, #2a1f0d),
                linear-gradient(150deg, #2a1f0d 12%, transparent 12.5%, transparent 87%, #2a1f0d 87.5%, #2a1f0d),
                linear-gradient(60deg, #40300e 25%, transparent 25.5%, transparent 75%, #40300e 75%, #40300e),
                linear-gradient(60deg, #40300e 25%, transparent 25.5%, transparent 75%, #40300e 75%, #40300e);
            background-position: 0 0, 0 0, 40px 70px, 40px 70px, 0 0, 40px 70px;
            background-size: 80px 140px;
            border: 8px solid #2a1f0d;
            border-radius: 4px;
            padding: 20px;
            margin: 30px 0;
            box-shadow: 
                0 0 0 4px #654321,
                inset 0 0 0 4px #654321,
                0 5px 15px rgba(0, 0, 0, 0.5);
            position: relative;
            color: #FFD700;
            image-rendering: pixelated;
        }

        .session-leaderboard::before {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            right: 4px;
            bottom: 4px;
            border: 2px solid #8B4513;
            pointer-events: none;
        }

        .leaderboard-title {
            font-size: 20px;
            margin-bottom: 20px;
            text-align: center;
            color: #FFD700;
            text-shadow: 2px 2px #000;
            font-family: 'Press Start 2P', cursive;
            letter-spacing: 1px;
        }

        .leaderboard-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 8px 16px;
            border: 2px solid #8B4513;
            background: #2a1f0d;
            cursor: pointer;
            transition: all 0.2s step-end;
            color: #FFD700;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            text-shadow: 2px 2px #000;
            margin: 0 4px;
            image-rendering: pixelated;
        }

        .tab-btn.active {
            background: #4a3810;
            border-color: #FFD700;
            color: #FFD700;
            transform: translate(0, 2px);
        }

        .leaderboard-content {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border: 2px solid #8B4513;
        }

        .empty-leaderboard {
            text-align: center;
            padding: 20px;
            color: #FFD700;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            line-height: 1.6;
            text-shadow: 2px 2px #000;
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 2px solid #8B4513;
            transition: all 0.2s step-end;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
        }

        .leaderboard-entry:hover {
            background: rgba(139, 69, 19, 0.3);
            transform: translate(2px, 0);
        }

        .entry-rank {
            font-weight: bold;
            color: #667eea;
            width: 30px;
        }

        .entry-name {
            flex: 1;
            margin: 0 10px;
        }

        .entry-score {
            font-weight: bold;
            color: #2d3748;
        }

        .entry-time {
            margin-left: 15px;
            color: #718096;
            font-size: 0.9em;
        }

        @media (max-width: 600px) {
            .container {
                border-radius: 0;
                margin: 0;
                padding: 10px;
            }

            .header h1 {
                font-size: 16px;
                padding: 0 20px;
            }

            .question-text {
                font-size: 14px;
            }

            .buttons {
                flex-direction: column;
            }

            .matching-container {
                grid-template-columns: 1fr;
            }

            .level-selection {
                grid-template-columns: 1fr;
                margin: 15px 0;
            }

            .mode-btn {
                min-width: 120px;
                padding: 12px;
            }

            .level-card {
                margin: 8px 4px;
                padding: 12px;
                min-width: auto;
            }

            .level-name {
                font-size: 10px;
            }

            .level-description {
                font-size: 8px;
            }

            .level-icon {
                font-size: 24px;
                margin-bottom: 8px;
            }

            body {
                padding: 10px;
            }

            .content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="level-up-overlay" id="levelUpOverlay">
        <div class="level-up-content">
            <h2 id="levelUpMessage"></h2>
            <p id="levelUpDescription"></p>
            <button class="btn btn-primary" id="levelUpContinue">Weiter</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="xp-container">
                <span>XP: <strong id="xpDisplay">0</strong></span>
            </div>
            <div class="level-badge" id="levelBadge">Level 1</div>
            <div id="timerDisplay" class="timer-display" style="display: none;">
                Zeit: <span id="timer">00:00</span>
            </div>
            <h1>📚 Web-basierte Anwendungssysteme</h1>
            <p>Interaktiver Wissenstest</p>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>

        <div class="content">
            <!-- START SCREEN -->
            <div id="startScreen" class="start-screen">
                <h2>Willkommen zum Quiz!</h2>
                <p>Wähle deinen Schwierigkeitsgrad und teste dein Wissen!</p>

                <div class="session-leaderboard wooden-board">
                    <h3 class="leaderboard-title">🏆 Bestenliste</h3>
                    <div class="leaderboard-tabs">
                        <button class="tab-btn active" data-mode="normal">Normal</button>
                        <button class="tab-btn" data-mode="speedrun">Speedrun</button>
                    </div>
                    <div id="startLeaderboardContent" class="leaderboard-content">
                        <div class="empty-leaderboard">Noch keine Einträge vorhanden.<br>Sei der Erste!</div>
                    </div>
                </div>

                <div class="player-name-wrapper">
                    <label class="player-name-label" for="playerName">Dein Name (für die Auswertung)</label>
                    <input id="playerName" class="name-input" type="text" placeholder="z.B. Luca, Marie, etc.">
                </div>

                <div class="mode-selection" style="margin-bottom: 30px;">
                    <label style="display: block; margin-bottom: 15px; color: #4a5568; font-weight: 600; font-size: 1.1em;">Wähle deinen Spielmodus:</label>
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button class="mode-btn selected" data-mode="normal">
                            <div style="font-size: 24px; margin-bottom: 8px;">🎯</div>
                            <div style="font-weight: 600;">Normal</div>
                            <div style="font-size: 0.8em; opacity: 0.8;">Klassisches Quiz</div>
                        </button>
                        <button class="mode-btn" data-mode="speedrun">
                            <div style="font-size: 24px; margin-bottom: 8px;">⚡</div>
                            <div style="font-weight: 600;">Speedrun</div>
                            <div style="font-size: 0.8em; opacity: 0.8;">Gegen die Zeit</div>
                        </button>
                        <button class="mode-btn" data-mode="practice" id="practiceBtn">
                            <div style="font-size: 24px; margin-bottom: 8px;">📚</div>
                            <div style="font-weight: 600;">Übung</div>
                            <div style="font-size: 0.8em; opacity: 0.8;">Falsche Fragen üben</div>
                    </button>
                    </div>
                    <div id="practiceInfo" style="display: none; margin-top: 15px; padding: 10px; background: rgba(102, 126, 234, 0.1); border-radius: 8px; font-size: 14px; color: #4a5568;">
                        Im Übungsmodus kannst du die Fragen wiederholen, die du in den letzten Durchläufen falsch beantwortet hast.
                    </div>
                </div>

                <div class="level-selection">
                    <div class="level-card" data-level="easy">
                        <div class="level-icon">🌱</div>
                        <div class="level-name">Einfach</div>
                        <div class="level-description">Grundlagen & Basiswissen</div>
                    </div>
                    <div class="level-card" data-level="medium">
                        <div class="level-icon">⚡</div>
                        <div class="level-name">Mittel</div>
                        <div class="level-description">Fortgeschrittene Konzepte</div>
                    </div>
                    <div class="level-card" data-level="hard">
                        <div class="level-icon">🔥</div>
                        <div class="level-name">Schwer</div>
                        <div class="level-description">Komplexe Themen</div>
                    </div>
                    <div class="level-card" data-level="expert">
                        <div class="level-icon">💎</div>
                        <div class="level-name">Experte</div>
                        <div class="level-description">Master-Level</div>
                    </div>
                    <div class="level-card" data-level="vorlesung">
                        <div class="level-icon">🎓</div>
                        <div class="level-name">Vorlesung</div>
                        <div class="level-description">Vom Fragen Blatt</div>
                    </div>
                </div>

                <button class="btn btn-primary" id="startBtn" disabled>Quiz starten</button>
            </div>

            <!-- QUESTIONS -->
            <div id="questionsContainer"></div>

            <!-- RESULT SCREEN -->
            <div id="resultScreen" class="result-container">
                <div class="score-circle">
                    <div class="score-text" id="scoreText"></div>
                </div>
                <div class="result-message" id="resultMessage"></div>
                <div class="result-details" id="resultDetails"></div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="statCorrect">0</div>
                    <div class="stat-label">Richtig</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statWrong">0</div>
                    <div class="stat-label">Falsch</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statXP">0</div>
                    <div class="stat-label">XP Gewonnen</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statLevel">1</div>
                    <div class="stat-label">Level Erreicht</div>
                </div>
            </div>

            <div class="session-leaderboard">
                <h3 class="leaderboard-title">🏆 Session Bestenliste</h3>
                <div class="leaderboard-tabs">
                    <button class="tab-btn active" data-mode="normal">Normal</button>
                    <button class="tab-btn" data-mode="speedrun">Speedrun</button>
                </div>
                <div id="leaderboardContent" class="leaderboard-content"></div>
            </div>            <div id="leaderboardSection" class="leaderboard">
                <div class="leaderboard-title">🏆 Session Bestenliste</div>
                <div id="leaderboardContent"></div>
            </div>

            <div class="share-box">
                <div style="font-weight:600; margin-bottom:10px;">✨ Mit anderen teilen</div>
                <a
                    id="whatsappShareBtn"
                    class="btn btn-whatsapp"
                    href="#"
                    target="_blank"
                    rel="noopener noreferrer"
                    style="text-decoration:none; display:inline-block; margin-bottom:10px;"
                >Auf WhatsApp teilen 💬</a>
                <div class="share-hint" id="shareHint">
                    Schick einfach die HTML-Datei rum oder lad sie irgendwo hoch und teile den Link 👍
                </div>
            </div>                <div class="buttons" style="margin-top:40px;">
                    <button class="btn btn-primary" id="restartBtn">Nochmal versuchen</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Funktion zum Mischen eines Arrays
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Funktion zum Generieren einer zufälligen Variante einer Basis-Frage.
        // Ziel: häufig den Basistyp beibehalten, aber sinnvolle Varianten (insb. matching/sort)
        // erzeugen und dabei korrekte Antworten konsistent halten.
        // Hilfsfunktion zum Mischen und Auswählen von n Elementen aus einem Array
        function getRandomElements(array, n) {
            const shuffled = [...array].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, n);
        }

        const vorlesungQuestions = [
            {
                type: "multiple",
                question: "Was ist das Basisprotokoll des WWW?",
                options: [
                    "FTP - File Transfer Protocol",
                    "HTTP - Hypertext Transfer Protocol",
                    "SMTP - Simple Mail Transfer Protocol",
                    "TCP - Transmission Control Protocol"
                ],
                wrongAnswerPool: "protocols",
                correct: 1,
                explanation: "HTTP (Hypertext Transfer Protocol) ist das Basisprotokoll des WWW.",
                xp: 10
            },
            {
                type: "text",
                question: "Was ist eine Web-Anwendung? (Geben Sie die Definition ein)",
                correct: ["web-anwendung", "client-server", "webbrowser", "web-technologien"],
                explanation: "Eine Web-Anwendung ist eine auf Web-Technologien basierende Client-Server-Anwendung. Bedienung erfolgt über Webbrowser oder dedizierte Clients, mit Webserver, Applikationsserver und Datenbanksystem serverseitig. Die Kommunikation erfolgt über HTTP, typischerweise unter Einsatz von Webframeworks.",
                xp: 10
            },
            {
                type: "checkbox",
                question: "Welche Vorteile bietet eine web-basierte Anwendung? (Wählen Sie mindestens 5)",
                options: [
                    "Parallele Nutzung",
                    "Informationsaustausch in Echtzeit",
                    "Zugriff von überall",
                    "Nutzung durch Thin-Clients/kleine Geräte",
                    "Einfacher Datenaustausch über standardisierte Schnittstellen",
                    "Keine Nutzer-Updates nötig",
                    "Skalierbarkeit",
                    "Modularisierung (Microservices/Web Services)"
                ],
                correct: [0, 1, 2, 3, 4, 5, 6, 7],
                explanation: "Web-basierte Anwendungen bieten zahlreiche Vorteile: Parallele Nutzung, Echtzeit-Informationsaustausch, universeller Zugriff, Thin-Client-Nutzung, standardisierte Schnittstellen, automatische Updates, Skalierbarkeit und Modularisierung.",
                xp: 15
            },
            {
                type: "checkbox",
                question: "Welche HTTP-Methoden gehören zu Version 1.1?",
                options: [
                    "GET",
                    "HEAD",
                    "POST",
                    "PUT",
                    "DELETE",
                    "CONNECT",
                    "OPTIONS",
                    "TRACE",
                    "PATCH"
                ],
                correct: [0, 1, 2, 3, 4, 5, 6, 7, 8],
                explanation: "HTTP 1.1 umfasst die Methoden: GET, HEAD, POST, PUT, DELETE, CONNECT, OPTIONS, TRACE und PATCH.",
                xp: 15
            },
            {
                type: "multiple",
                question: "Wozu dient das Keep-Alive Header-Feld in HTTP?",
                options: [
                    "Zum dauerhaften Speichern von Cookies",
                    "Zur Wiederverwendung der TCP-Verbindung für mehrere Anfragen",
                    "Zum Caching von Webseitendaten",
                    "Zur Authentifizierung von Benutzern"
                ],
                correct: 1,
                explanation: "Keep-Alive hält die TCP-Verbindung zwischen Client und Server offen, damit mehrere HTTP-Anfragen über dieselbe Verbindung möglich sind. Dies ermöglicht auch Pipelining.",
                xp: 10
            },
            {
                type: "fillblank",
                question: "HTTP-Nachrichten bestehen aus: _____ → _____ → Leerzeile → Body",
                blanks: ["Start-Zeile", "Header-Felder"],
                explanation: "HTTP-Nachrichten bestehen aus: Start-Zeile (Request-Line oder Status-Line) → Header-Felder → Leerzeile → Body (Nutzdaten).",
                xp: 10
            },
            {
                type: "multiple",
                question: "Was ist der Unterschied zwischen HTTP-Anfrage und HTTP-Statusinformation in der Start-Zeile?",
                options: [
                    "Request: Method SP Request-URI SP HTTP-Version CRLF; Response: HTTP-Version SP Status-Code SP Reason-Phrase CRLF",
                    "Kein Unterschied, beide haben das gleiche Format",
                    "Request verwendet GET, Response verwendet POST",
                    "Request enthält immer einen Body, Response nie"
                ],
                correct: 0,
                explanation: "Request-Start-Line: Method SP Request-URI SP HTTP-Version CRLF; Response-Start-Line: HTTP-Version SP Status-Code SP Reason-Phrase CRLF",
                xp: 15
            },
            {
                type: "checkbox",
                question: "Welche Verbesserungen wurden durch HTTP 1.1 eingeführt?",
                options: [
                    "Verbindung wird standardmäßig nicht sofort getrennt",
                    "Unterstützung für mehrere Anfragen über dieselbe Verbindung",
                    "Pipelining",
                    "Effizientere Nutzung der TCP-Verbindung"
                ],
                correct: [0, 1, 2, 3],
                explanation: "HTTP 1.1 brachte folgende Verbesserungen: persistente Verbindungen, Multiplexing von Anfragen, Pipelining und effizientere TCP-Nutzung.",
                xp: 15
            },
            {
                type: "checkbox",
                question: "Welche Neuerungen brachte HTTP/2?",
                options: [
                    "Nur noch eine TCP-Verbindung nötig",
                    "Kompression der Header",
                    "Binäres statt textbasiertes Protokoll",
                    "Server Push möglich",
                    "Unterteilung in Streams und Frames"
                ],
                wrongAnswerPool: "protocols",
                additionalWrongAnswers: [
                    "Ausschließlich verschlüsselte Verbindungen",
                    "Unterstützung nur für mobile Geräte",
                    "Automatische Übersetzung von Inhalten",
                    "Integrierte Firewall-Funktionen",
                    "Direkte Datenbankanbindung"
                ],
                correct: [0, 1, 2, 3, 4],
                explanation: "HTTP/2 führte ein: Single TCP Connection, Header-Kompression, binäres Protokoll, Server Push und Stream/Frame-Struktur.",
                xp: 15
            },
            {
                difficulty: 1,
                type: "multiple",
                question: "Was ist der Unterschied zwischen Internet und World Wide Web (WWW)?",
                options: [
                    "Das Internet ist neuer als das WWW",
                    "WWW und Internet sind dasselbe",
                    "Internet ist die physikalische Verbindung; WWW ist die Aufteilung in Web-Client und Web-Server",
                    "Internet ist nur für E-Mails, WWW nur für Webseiten"
                ],
                correct: 2,
                explanation: "Internet ist die Verbindung unzähliger Subnetze (Interconnected Network, physikalische Verbindung). World Wide Web ist die Aufteilung der Kommunikation in Web-Client und Web-Server zur gezielten Adressierung von Dateien.",
                xp: 10
            },
            {
                difficulty: 1,
                type: "multiple",
                question: "Wie hieß der Vorläufer des Internet und was waren dessen Ziele?",
                options: [
                    "ARPANET; Ziel war ein ausfallsicheres, weltweites Rechnernetz",
                    "BITNET; Ziel war E-Mail-Kommunikation",
                    "NSFNET; Ziel war wissenschaftlicher Austausch",
                    "CSNET; Ziel war Verbindung von Universitäten"
                ],
                correct: 0,
                explanation: "ARPANET war der Vorläufer. Ziele: Ein Netz, in dem weltweit Rechner verbunden sind, das auch funktioniert, wenn Teile ausgefallen sind.",
                xp: 10
            },
            {
                difficulty: 1,
                type: "multiple",
                question: "Wie waren die Rechner des ARPANET untergliedert?",
                options: [
                    "Nur Server und Clients",
                    "Hosts (Benutzerrechner), IMPs (Netzrechner), TIPs (Terminal-Zugang)",
                    "Mainframes und Terminals",
                    "Workstations und Peripheriegeräte"
                ],
                correct: 1,
                explanation: "Die Rechner waren untergliedert in: Hosts (Benutzerrechner), Interface Message Processor (IMP, Netzrechner zur Nachrichtenzerlegung und Paketvermittlung), Terminal IMP (TIP, spezielle IMPs für direkten Terminalzugang)",
                xp: 10
            },
            {
                difficulty: 1,
                type: "multiple",
                question: "Wozu dienten die Interface Message Processors (IMP)?",
                options: [
                    "Zur Benutzerauthentifizierung",
                    "Zur Nachrichtenzerlegung und Paketvermittlung",
                    "Zur Datenspeicherung",
                    "Zur Grafikverarbeitung"
                ],
                correct: 1,
                explanation: "Die Interface Message Processors (IMPs) waren Netzrechner zur Nachrichtenzerlegung und Paketvermittlung.",
                xp: 10
            },
            {
                difficulty: 1,
                type: "multiple",
                question: "Was versteht man unter Paketvermittlung?",
                options: [
                    "Versenden von Bytes durch elektromagnetische Signale",
                    "Physische Zustellung von Paketen",
                    "Speicherung von Daten in Paketen",
                    "Verwaltung von Netzwerkprotokollen"
                ],
                correct: 0,
                explanation: "Unter Paketvermittlung versteht man das Versenden von Bytes durch elektromagnetische Signale.",
                xp: 10
            },
            {
                difficulty: 1,
                type: "multiple",
                question: "Was war der erste Dienst des Internets?",
                options: [
                    "World Wide Web (1989)",
                    "E-Mail-Protokoll (1972, Ray Tomlinson)",
                    "FTP (1971)",
                    "Telnet (1969)"
                ],
                correct: 1,
                explanation: "1972 wurde das E-Mail-Protokoll von Ray Tomlinson für das ARPANET entwickelt - der erste Dienst des Internets.",
                xp: 10
            },
            {
                difficulty: 1,
                type: "checkbox",
                question: "Welche sind die grundlegenden Protokolle des Internet?",
                options: [
                    "TCP",
                    "IP",
                    "HTTP",
                    "FTP"
                ],
                correct: [0, 1],
                explanation: "Die grundlegenden Protokolle des Internet sind TCP und IP.",
                xp: 10
            },
            {
                difficulty: 1,
                type: "multiple",
                question: "Wer erfand das WWW?",
                options: [
                    "Tim Berners-Lee",
                    "Vint Cerf",
                    "Larry Page",
                    "Bill Gates"
                ],
                correct: 0,
                explanation: "Tim Berners-Lee erfand das World Wide Web (zusammen mit Robert Cailliau).",
                xp: 10
            },
            {
                difficulty: 1,
                type: "checkbox",
                question: "Was sind die Basiskonzepte des WWW?",
                options: [
                    "Client-Server-Architektur",
                    "Hypermedia-Inhalte",
                    "Links auf Objekte im Netz (URIs)",
                    "Textauszeichnungssprache HTML",
                    "Übertragungsprotokoll HTTP"
                ],
                correct: [0, 1, 2, 3, 4],
                explanation: "Die Basiskonzepte des WWW sind: Client-Server-Architektur, Hypermedia-Inhalte, Links auf Objekte im Netz (URIs), Textauszeichnungssprache HTML und das Übertragungsprotokoll HTTP.",
                xp: 10
            }
        ];

        const baseQuestions = [
            // NEUE SPRING BOOT & ENTWICKLUNG FRAGEN

            // LEVEL EASY (Einfach)
            {
                difficulty: 1,
                type: "multiple",
                question: "Wohin schreibt Spring Boot Logs standardmäßig ohne zusätzliche Konfiguration?",
                options: [
                    "In die Konsole (Standard Output)",
                    "In eine Datei namens 'application.log'",
                    "In eine Datenbank",
                    "In das Windows Event Log"
                ],
                correct: 0,
                explanation: "Standardmäßig schreibt Spring Boot alle Logs in die Konsole (Standard Output). Für andere Ziele ist zusätzliche Konfiguration nötig.",
                xp: 10
            },
            {
                difficulty: 1,
                type: "checkbox",
                question: "Welche Log-Level sind in Spring Boot standardmäßig verfügbar? (Mehrfachauswahl)",
                options: [
                    "ERROR",
                    "WARN",
                    "INFO",
                    "DEBUG",
                    "TRACE"
                ],
                correct: [0, 1, 2, 3, 4],
                explanation: "Spring Boot unterstützt die Standard-Log-Level: ERROR (kritisch), WARN (Warnungen), INFO (Information), DEBUG (Entwicklung) und TRACE (detailliert).",
                xp: 15
            },
            {
                difficulty: 1,
                type: "multiple",
                question: "Was ist das grundlegende Schema für User Stories?",
                options: [
                    "Als <Rolle> möchte ich <Ziel>, damit <Nutzen>",
                    "Wenn <Bedingung> dann <Aktion>",
                    "Gegeben <Zustand> wenn <Ereignis> dann <Ergebnis>",
                    "Falls <Problem> soll <Lösung> implementiert werden"
                ],
                correct: 0,
                explanation: "User Stories folgen dem Schema: 'Als <Rolle> möchte ich <Ziel>, damit <Nutzen>'. Dies macht Anforderungen verständlich und nutzerorientiert.",
                xp: 10
            },

            // LEVEL MEDIUM (Mittel)
            {
                difficulty: 2,
                type: "matching",
                question: "Ordne die Logging-Properties ihren Effekten zu:",
                pairs: [
                    { left: "logging.file", right: "Definiert eine spezifische Log-Datei" },
                    { left: "logging.path", right: "Setzt das Verzeichnis für Log-Dateien" },
                    { left: "logging.level.*", right: "Konfiguriert Log-Level für Packages" },
                    { left: "logging.pattern.console", right: "Bestimmt das Format der Konsolenausgabe" }
                ],
                explanation: "Die verschiedenen Logging-Properties steuern unterschiedliche Aspekte: Dateien, Pfade, Level und Ausgabeformat.",
                xp: 25
            },
            {
                difficulty: 2,
                type: "multiple",
                question: "Was bewirkt logging.level.edu.fra.uas=debug in der Konfiguration?",
                options: [
                    "Setzt DEBUG-Level für das spezifische Package und Unterpackages",
                    "Aktiviert Debugging für die gesamte Anwendung",
                    "Loggt nur Fehler aus dem edu.fra.uas Package",
                    "Deaktiviert Logging für andere Packages"
                ],
                correct: 0,
                explanation: "Diese Einstellung setzt das Log-Level DEBUG für das Package edu.fra.uas und alle seine Unterpackages. Andere Packages bleiben unberührt.",
                xp: 20
            },

            // LEVEL HARD (Schwer)
            {
                difficulty: 3,
                type: "checkbox",
                question: "Welche Vorteile bietet strukturiertes Logging (SLF4J/Logback) gegenüber System.out.println in Spring Boot? (Mehrfachauswahl)",
                options: [
                    "Konfigurierbare Log-Level und Filter",
                    "Performance durch asynchrones Logging",
                    "Standardisierte Formatierung",
                    "Integration mit Spring Boot Actuator",
                    "Automatische Dateirotation"
                ],
                correct: [0, 1, 2, 3, 4],
                explanation: "Strukturiertes Logging bietet viele Vorteile: konfigurierbare Level, bessere Performance, einheitliche Formate, Monitoring-Integration und Dateiverwaltung.",
                xp: 30
            },
            {
                difficulty: 3,
                type: "multiple",
                question: "Was passiert, wenn @Autowired an einer Feldstelle entfernt wird?",
                options: [
                    "Das Feld bleibt null und führt zu NullPointerException bei Verwendung",
                    "Spring erstellt automatisch eine neue Instanz",
                    "Die Anwendung startet nicht",
                    "Es wird eine Warnung ausgegeben"
                ],
                correct: 0,
                explanation: "Ohne @Autowired erfolgt keine Dependency Injection. Das Feld bleibt null, was bei Verwendung zu einer NullPointerException führt.",
                xp: 30
            },

            // LEVEL EXPERT (Experte)
            {
                difficulty: 4,
                type: "matching",
                question: "Ordne die Test-Konzepte ihren Haupteigenschaften zu:",
                pairs: [
                    { left: "@SpringBootTest", right: "Lädt den vollständigen Application Context" },
                    { left: "AssertJ", right: "Bietet fluent assertions und bessere Fehlermeldungen" },
                    { left: "Slice Tests", right: "Testet nur spezifische Schichten der Anwendung" },
                    { left: "Unit Tests", right: "Testet isolierte Komponenten ohne Spring Context" }
                ],
                explanation: "@SpringBootTest ist für Integrationstests mit vollem Context, AssertJ verbessert die Testlesbarkeit, Slice Tests fokussieren einzelne Schichten, Unit Tests sind am schnellsten.",
                xp: 40
            },
            {
                difficulty: 4,
                type: "multiple",
                question: "Welche Funktion hat der <parent>-Eintrag in der pom.xml bei Spring Boot?",
                options: [
                    "Definiert Versionen, Dependencies und Plugins durch Vererbung",
                    "Ist nur für Multi-Modul-Projekte erforderlich",
                    "Dient ausschließlich der Dokumentation",
                    "Wird nur für Test-Konfigurationen verwendet"
                ],
                correct: 0,
                explanation: "Der <parent>-Eintrag ermöglicht die Vererbung von Versionen, Dependencies und Plugin-Konfigurationen vom Spring Boot Parent POM, was die Projektkonfiguration vereinfacht.",
                xp: 40
            },
            {
                difficulty: 4,
                type: "checkbox",
                question: "Was sind die Besonderheiten eines CommandLineRunner als @Bean? (Mehrfachauswahl)",
                options: [
                    "Wird nach Kontext-Initialisierung ausgeführt",
                    "Kann mehrfach im Projekt definiert werden",
                    "Hat Zugriff auf andere Beans",
                    "Ermöglicht Start-up Logik",
                    "Unterstützt Ordering mit @Order"
                ],
                correct: [0, 1, 2, 3, 4],
                explanation: "CommandLineRunner als @Bean: läuft nach Kontext-Start, mehrfache Definition möglich, hat Bean-Zugriff, ideal für Start-up Logik, unterstützt Reihenfolge via @Order.",
                xp: 45
            },

            // ORIGINAL FRAGEN
            // LEVEL EASY (Einfach)
            {
                difficulty: 1,
                type: "multiple",
                question: "Was ist eine Bean im Spring-Container?",
                options: [
                    "Ein Java-Objekt, das von Spring verwaltet wird",
                    "Eine Datenbankverbindung",
                    "Ein UI-Element",
                    "Eine Konfigurationsdatei"
                ],
                correct: 0,
                explanation: "Eine Bean ist ein Java-Objekt, das vom Spring Container verwaltet wird - inklusive Erstellung, Konfiguration und Lebenszyklus-Management.",
                xp: 10
            },
            {
                difficulty: 1,
                type: "multiple",
                question: "Welches Log-Level zeigt die wichtigsten Fehler an?",
                options: [
                    "DEBUG",
                    "INFO",
                    "ERROR",
                    "TRACE"
                ],
                correct: 2,
                explanation: "ERROR ist das Log-Level für die kritischsten Fehlermeldungen. Es zeigt schwerwiegende Probleme an, die sofortige Aufmerksamkeit erfordern.",
                xp: 10
            },
            {
                difficulty: 1,
                type: "multiple",
                question: "Was ist ein Fork in GitHub?",
                options: [
                    "Eine Kopie eines Repositories unter deinem eigenen Account",
                    "Ein Branch in einem Repository",
                    "Ein Pull Request",
                    "Ein Commit in der Historie"
                ],
                correct: 0,
                explanation: "Ein Fork ist eine persönliche Kopie eines fremden Repositories unter deinem GitHub-Account. Dies ermöglicht es dir, Änderungen vorzunehmen, ohne das Original zu beeinflussen.",
                xp: 10
            },

            // LEVEL MEDIUM (Mittel)
            {
                difficulty: 2,
                type: "matching",
                question: "Ordne die Log-Level ihrer typischen Verwendung zu:",
                pairs: [
                    { left: "ERROR", right: "Kritische Fehler, die sofortige Aktion erfordern" },
                    { left: "WARN", right: "Potenziell schädliche Situationen" },
                    { left: "INFO", right: "Wichtige Geschäftsereignisse" },
                    { left: "DEBUG", right: "Detaillierte Entwicklerinformationen" }
                ],
                explanation: "Die Log-Level haben unterschiedliche Prioritäten und Verwendungszwecke: ERROR für kritische Fehler, WARN für Warnungen, INFO für wichtige Events, DEBUG für Entwicklerdetails.",
                xp: 25
            },
            {
                difficulty: 2,
                type: "checkbox",
                question: "Welche Vorteile bietet strukturiertes Logging gegenüber System.out.println? (Mehrfachauswahl)",
                options: [
                    "Konfigurierbare Log-Level",
                    "Bessere Filterbarkeit",
                    "Mehrere Ausgabekanäle möglich",
                    "Formatierte Zeitstempel",
                    "Schnellere Ausführung"
                ],
                correct: [0, 1, 2, 3],
                explanation: "Strukturiertes Logging bietet viele Vorteile: konfigurierbare Level, Filterbarkeit, multiple Ausgabekanäle und automatische Zeitstempel. Die Ausführungsgeschwindigkeit ist nicht primär relevant.",
                xp: 20
            },
            {
                difficulty: 2,
                type: "multiple",
                question: "Was ist die Hauptaufgabe des CommandLineRunner in Spring Boot?",
                options: [
                    "Datenbankverbindungen aufbauen",
                    "Code beim Anwendungsstart ausführen",
                    "REST-Endpunkte definieren",
                    "Logging konfigurieren"
                ],
                correct: 1,
                explanation: "CommandLineRunner ist ein Interface, dessen run()-Methode nach der Initialisierung der Spring Boot App ausgeführt wird. Es eignet sich für Initialisierungscode beim Start.",
                xp: 20
            },

            // LEVEL HARD (Schwer)
            {
                difficulty: 3,
                type: "multiple",
                question: "Was bedeutet 'Inversion of Control' im Spring-Kontext?",
                options: [
                    "Die Umkehrung der Programmflusssteuerung",
                    "Das manuelle Erstellen von Objekten",
                    "Die direkte Objektreferenzierung",
                    "Die Verwendung von statischen Methoden"
                ],
                correct: 0,
                explanation: "Inversion of Control bedeutet, dass die Kontrolle über Objekterstellung und -verwaltung an den Spring Container übertragen wird, statt sie selbst zu implementieren.",
                xp: 30
            },
            {
                difficulty: 3,
                type: "checkbox",
                question: "Welche Aussagen über Konstruktor-Injektion sind korrekt? (Mehrfachauswahl)",
                options: [
                    "Garantiert vollständige Initialisierung",
                    "Unterstützt Immutability",
                    "Macht Abhängigkeiten explizit",
                    "Ist flexibler als Setter-Injektion",
                    "Erfordert weniger Code als Feld-Injektion"
                ],
                correct: [0, 1, 2],
                explanation: "Konstruktor-Injektion wird bevorzugt, weil sie vollständige Initialisierung garantiert, Immutability ermöglicht und Abhängigkeiten explizit macht. Sie ist nicht flexibler und erfordert mehr Code.",
                xp: 30
            },
            {
                difficulty: 3,
                type: "matching",
                question: "Ordne die Spring-Annotationen ihrer Hauptfunktion zu:",
                pairs: [
                    { left: "@SpringBootApplication", right: "Kombiniert mehrere Basis-Annotationen" },
                    { left: "@Component", right: "Markiert Klasse als Spring-verwaltete Komponente" },
                    { left: "@Bean", right: "Definiert Methode zur Bean-Erstellung" },
                    { left: "@Autowired", right: "Injiziert Abhängigkeiten" }
                ],
                explanation: "Die Annotationen haben unterschiedliche Zwecke: @SpringBootApplication für App-Konfiguration, @Component für Komponenten-Scanning, @Bean für explizite Bean-Definition, @Autowired für Dependency Injection.",
                xp: 35
            },

            // LEVEL EXPERT (Experte)
            {
                difficulty: 4,
                type: "checkbox",
                question: "Welche Konzepte sind Teil der Spring Boot Auto-Konfiguration? (Mehrfachauswahl)",
                options: [
                    "Konvention vor Konfiguration",
                    "Bedingte Bean-Registrierung",
                    "Externe Konfigurationsdateien",
                    "Starter Dependencies",
                    "Metriken und Health-Checks"
                ],
                correct: [0, 1, 2, 3, 4],
                explanation: "Spring Boot's Auto-Konfiguration basiert auf mehreren Konzepten: Konventionen, bedingter Bean-Registrierung, externer Konfiguration, Starter Dependencies und integrierten Monitoring-Funktionen.",
                xp: 40
            },
            {
                difficulty: 4,
                type: "matching",
                question: "Ordne die Maven-Konzepte ihrer Bedeutung zu:",
                pairs: [
                    { left: "groupId", right: "Organisationsweiter, eindeutiger Identifier" },
                    { left: "artifactId", right: "Name des Projekts/der Bibliothek" },
                    { left: "version", right: "Spezifische Release-Kennung" },
                    { left: "parent", right: "Vererbungshierarchie und gemeinsame Konfiguration" }
                ],
                explanation: "Maven POM-Elemente haben spezifische Rollen: groupId für Organisation, artifactId für Projektname, version für Release-Identifikation, parent für Vererbung.",
                xp: 40
            },
            {
                difficulty: 4,
                type: "checkbox",
                question: "Welche Aspekte unterscheiden Integration-Tests von Unit-Tests in Spring Boot? (Mehrfachauswahl)",
                options: [
                    "Vollständiger Spring Kontext wird geladen",
                    "Testen mehrerer Komponenten zusammen",
                    "Verwendung von @SpringBootTest",
                    "Längere Ausführungszeit",
                    "Externe Ressourcen können eingebunden sein"
                ],
                correct: [0, 1, 2, 3, 4],
                explanation: "Integration-Tests unterscheiden sich durch: Laden des Spring Kontexts, Testing mehrerer Komponenten, @SpringBootTest Annotation, längere Laufzeit und mögliche externe Ressourcen.",
                xp: 45
            },

            // ORIGINAL FRAGEN
            // LEVEL EASY (Einfach)
            {
                difficulty: 1,
                type: "multiple",
                question: "Was ist GitHub?",
                options: [
                    "Ein Texteditor",
                    "Eine Codehosting-Plattform für Versionskontrolle",
                    "Eine Programmiersprache",
                    "Ein Betriebssystem"
                ],
                correct: 1,
                explanation: "GitHub ist eine Codehosting-Plattform für die Versionskontrolle und Zusammenarbeit in Projekten.",
                xp: 10
            },

            // LEVEL MEDIUM (Mittel)
            {
                difficulty: 2,
                type: "multiple",
                question: "Was ist eine Bean in Spring?",
                options: [
                    "Eine JavaScript-Bibliothek",
                    "Eine Datenbank-Tabelle",
                    "Ein verwaltetes Java-Objekt innerhalb des Spring Containers",
                    "Ein Konfigurationsfile"
                ],
                correct: 2,
                explanation: "Eine Bean ist ein verwaltetes Java-Objekt innerhalb des Spring Containers. Die Bean wird erstellt, überwacht und gelöscht.",
                xp: 20
            },
            {
                difficulty: 2,
                type: "matching",
                question: "Ordne die Spring-Annotationen ihrer Funktion zu:",
                pairs: [
                    { left: "@SpringBootApplication", right: "Kennzeichnet die Main-Klasse" },
                    { left: "@Component", right: "Macht die Klasse zu einer Bean" },
                    { left: "@Autowired", right: "Injiziert ein Bean-Objekt" },
                    { left: "@Bean", right: "Definiert eine Bean-Methode" }
                ],
                explanation: "@SpringBootApplication markiert die Main-Klasse, @Component macht Klassen zu Beans, @Autowired injiziert Dependencies, @Bean definiert Bean-Methoden.",
                xp: 25
            },
            {
                difficulty: 2,
                type: "fillblank",
                question: "In Spring Boot wird die Konfiguration in der Datei _____ im Ordner _____ gespeichert.",
                blanks: ["application.properties", "resources"],
                explanation: "Die Datei application.properties im Ordner resources enthält die Konfiguration für Spring Boot Anwendungen.",
                xp: 20
            },
            {
                difficulty: 2,
                type: "sort",
                question: "Sortiere die Log-Level von niedrigster zu höchster Priorität:",
                items: ["ERROR", "WARN", "INFO", "DEBUG", "TRACE"],
                correct: ["TRACE", "DEBUG", "INFO", "WARN", "ERROR"],
                explanation: "Die Log-Level von niedrigster zu höchster Priorität: TRACE (am detailliertesten) → DEBUG → INFO → WARN → ERROR (kritischste Fehler).",
                xp: 25
            },
            {
                difficulty: 2,
                type: "multiple",
                question: "Was ist Maven?",
                options: [
                    "Ein Web-Framework",
                    "Eine Datenbank",
                    "Eine Programmiersprache",
                    "Ein Build-Management-Tool für Java-Projekte"
                ],
                correct: 3,
                explanation: "Maven ist ein Build-Management-Tool, das den Software-Erstellungszyklus verwaltet. Konfiguration erfolgt in pom.xml.",
                xp: 20
            },
            {
                difficulty: 2,
                type: "fillblank",
                question: "Um den Log-Level für ein Package auf DEBUG zu setzen, verwendet man in application.properties: logging.level._____.fra.uas=_____",
                blanks: ["edu", "debug"],
                explanation: "Mit logging.level.edu.fra.uas=debug wird der Log-Level für das Package edu.fra.uas auf DEBUG gesetzt.",
                xp: 20
            },

            // LEVEL HARD (Schwer)
            {
                difficulty: 3,
                type: "sort",
                question: "Sortiere die Schichten der 3-Tier-Architektur von oben nach unten:",
                items: ["Datenhaltungsschicht", "Anwendungslogik-Schicht", "Präsentationsschicht"],
                correct: ["Präsentationsschicht", "Anwendungslogik-Schicht", "Datenhaltungsschicht"],
                explanation: "3-Tier-Architektur von oben: Präsentationsschicht (UI) → Anwendungslogik (Business Logic) → Datenhaltung (Datenbank).",
                xp: 30
            },
            {
                difficulty: 3,
                type: "matching",
                question: "Ordne die REST-Prinzipien ihrer Beschreibung zu:",
                pairs: [
                    { left: "Stateless", right: "Zustandslosigkeit der Anfragen" },
                    { left: "Cacheability", right: "Responses können gecacht werden" },
                    { left: "Uniform Interface", right: "Einheitliche Schnittstelle" },
                    { left: "HATEOAS", right: "Links zu verwandten Ressourcen" }
                ],
                explanation: "REST-Prinzipien: Stateless (zustandslos), Cacheability (cachebar), Uniform Interface (einheitlich), HATEOAS (Hypermedia as Engine of Application State).",
                xp: 35
            },
            {
                difficulty: 3,
                type: "checkbox",
                question: "Welche HTTP-Methoden sind 'safe' (sicher)? (Mehrfachauswahl)",
                options: [
                    "POST",
                    "GET",
                    "PUT",
                    "HEAD",
                    "DELETE"
                ],
                correct: [1, 3],
                explanation: "Safe (sicher) sind nur GET und HEAD - sie ändern keine Daten auf dem Server. POST, PUT und DELETE ändern Daten.",
                xp: 30
            },
            {
                difficulty: 3,
                type: "fillblank",
                question: "Die Annotation _____ kennzeichnet Test-Methoden in JUnit, während _____ die Test-Klasse für Spring Boot markiert.",
                blanks: ["@Test", "@SpringBootTest"],
                explanation: "@Test markiert einzelne Test-Methoden, @SpringBootTest kennzeichnet die Test-Klasse für Spring Boot.",
                xp: 30
            },
            {
                difficulty: 3,
                type: "multiple",
                question: "Was passiert, wenn die @Autowired Annotation entfernt wird?",
                options: [
                    "Das Programm läuft schneller",
                    "Die Bean wird nicht injiziert und es gibt eine NullPointerException",
                    "Die Bean wird automatisch erstellt",
                    "Das Programm kompiliert nicht"
                ],
                correct: 1,
                explanation: "Ohne @Autowired wird das Bean-Objekt nicht injiziert und bleibt null, was zu einer NullPointerException führt, wenn darauf zugegriffen wird.",
                xp: 30
            },
            {
                difficulty: 3,
                type: "multiple",
                question: "Welche Operationen unterstützt GraphQL?",
                options: [
                    "SELECT, INSERT, UPDATE, DELETE",
                    "GET, POST, PUT, DELETE",
                    "Query, Mutation, Subscription",
                    "READ, WRITE, UPDATE"
                ],
                correct: 2,
                explanation: "GraphQL unterstützt: Query (Abfragen), Mutation (Änderungen), Subscription (Echtzeit-Updates).",
                xp: 30
            },

            // LEVEL EXPERT (Experte)
            {
                difficulty: 4,
                type: "matching",
                question: "Ordne die Komponenten des MVC-Patterns ihrer Rolle zu:",
                pairs: [
                    { left: "Model", right: "Datenmodell und Geschäftslogik" },
                    { left: "View", right: "Darstellung der Benutzeroberfläche" },
                    { left: "Controller", right: "Steuerung und Vermittlung" },
                    { left: "@RequestMapping", right: "Verknüpfung von URLs mit Methoden" }
                ],
                explanation: "MVC: Model (Daten/Logik), View (UI), Controller (Steuerung). @RequestMapping verbindet HTTP-Requests mit Handler-Methoden.",
                xp: 40
            },
            {
                difficulty: 4,
                type: "sort",
                question: "Sortiere den Maven Build-Zyklus in der richtigen Reihenfolge:",
                items: ["Installation", "Validierung", "Verifizierung", "Kompilierung", "Testen", "Paketieren"],
                correct: ["Validierung", "Kompilierung", "Testen", "Paketieren", "Verifizierung", "Installation"],
                explanation: "Maven Build-Zyklus: Validierung → Kompilierung → Testen → Paketieren → Integrationstests → Verifizierung → Installation → Verteilung.",
                xp: 40
            },
            {
                difficulty: 4,
                type: "fillblank",
                question: "In der pom.xml wird die Spring Boot Version im _____ -Tag mit dem artifactId _____ definiert.",
                blanks: ["parent", "spring-boot-starter-parent"],
                explanation: "Der <parent>-Tag mit artifactId 'spring-boot-starter-parent' bestimmt die Spring Boot Framework-Version.",
                xp: 40
            },
            {
                difficulty: 4,
                type: "checkbox",
                question: "Welche Eigenschaften hat Spring Boot? (Mehrfachauswahl)",
                options: [
                    "Benötigt externe War-Dateien",
                    "Eingebettete Container (Tomcat, Jetty)",
                    "Automatische Konfiguration soweit möglich",
                    "Generierung von Code und Konfiguration",
                    "Keine externen Laufzeitabhängigkeiten"
                ],
                correct: [1, 2, 4],
                explanation: "Spring Boot: eingebettete Container, automatische Konfiguration, keine externen Laufzeitabhängigkeiten, KEINE War-Dateien nötig, KEINE Code-Generierung.",
                xp: 40
            },
            {
                difficulty: 4,
                type: "multiple",
                question: "Welches Protokoll nutzt gRPC als Transportprotokoll und zu welcher OSI-Schicht gehört es?",
                options: [
                    "WebSocket, Schicht 6",
                    "TCP, Schicht 4",
                    "HTTP/2, Schicht 7",
                    "HTTP/1.1, Schicht 7"
                ],
                correct: 2,
                explanation: "gRPC nutzt HTTP/2 als Transportprotokoll, welches zur OSI-Schicht 7 (Anwendungsschicht) gehört.",
                xp: 40
            },
            {
                difficulty: 4,
                type: "text",
                question: "Was ist das besondere Feature von gRPC im Vergleich zu REST und GraphQL?",
                correct: ["bidirektionales streaming", "bidirectional streaming", "streaming"],
                explanation: "gRPC unterstützt bidirektionales Streaming in verschiedenen Formen: Unary, Server-Streaming, Client-Streaming, Bidirectional-Streaming.",
                xp: 40
            },
            {
                difficulty: 4,
                type: "fillblank",
                question: "Eine SPA (Single Page Application) lädt Inhalte dynamisch per _____ nach, ohne die Seite neu zu _____.",
                blanks: ["ajax", "laden"],
                explanation: "Bei einer SPA läuft die Anwendung auf einer HTML-Seite. Inhalte werden dynamisch per AJAX nachgeladen, ohne Seitenneuladung.",
                xp: 40
            },
            {
                difficulty: 4,
                type: "checkbox",
                question: "Welche sind serverseitige Technologien? (Mehrfachauswahl)",
                options: [
                    "JavaScript (Client)",
                    "PHP",
                    "Java Servlets",
                    "CSS",
                    "Node.js"
                ],
                correct: [1, 2, 4],
                explanation: "Serverseitige Technologien: PHP, Java Servlets, Node.js, Python (Django), Ruby on Rails. JavaScript und CSS laufen primär clientseitig.",
                xp: 40
            },
            {
                difficulty: 4,
                type: "matching",
                question: "Ordne die URL-Bestandteile dem Beispiel zu: http://fb2.fra-uas.de:8080/ebis/urls.html?prof=lehmann",
                pairs: [
                    { left: "Scheme", right: "http://" },
                    { left: "Hostname", right: "fb2.fra-uas.de" },
                    { left: "Port", right: ":8080" },
                    { left: "Query", right: "?prof=lehmann" }
                ],
                explanation: "URL-Struktur: Scheme (Protokoll) → Hostname (Domain) → Port → Path (Pfad) → Query (Parameter).",
                xp: 45
            },
            {
                difficulty: 4,
                type: "multiple",
                question: "Wofür steht die Abkürzung PHP (rekursives Akronym)?",
                options: [
                    "Personal Home Page",
                    "Private Hypertext Processor",
                    "PHP: Hypertext Preprocessor",
                    "Public HTML Protocol"
                ],
                correct: 2,
                explanation: "PHP steht für 'PHP: Hypertext Preprocessor' - ein rekursives Akronym. PHP ist eine serverseitige Skriptsprache.",
                xp: 40
            },

            // Zusätzliche gemischte Fragen
            {
                difficulty: 3,
                type: "multiple",
                question: "Was ist HATEOAS im Kontext von REST?",
                options: [
                    "Ein HTTP-Header",
                    "Eine Datenbank-Technologie",
                    "Hypermedia as Engine of Application State - Links in Responses",
                    "Ein JavaScript Framework"
                ],
                correct: 2,
                explanation: "HATEOAS (Hypermedia as the Engine of Application State): Der Server liefert in Responses Links zu verwandten Ressourcen mit.",
                xp: 30
            },
            {
                difficulty: 3,
                type: "fillblank",
                question: "Um eine Datei für Logging anzugeben, verwendet man logging._____ und für ein Verzeichnis logging._____",
                blanks: ["file", "path"],
                explanation: "Mit logging.file gibt man eine Datei an, mit logging.path ein Verzeichnis. Ohne Angabe wird in spring.log geschrieben.",
                xp: 30
            },
            {
                difficulty: 2,
                type: "multiple",
                question: "Wofür steht AJAX?",
                options: [
                    "Advanced Java and XML",
                    "Asynchronous JavaScript and XML",
                    "Automatic JSON and XML",
                    "Application JavaScript Architecture XML"
                ],
                correct: 1,
                explanation: "AJAX steht für Asynchronous JavaScript and XML - ermöglicht asynchrone Datenübertragung ohne Seitenneuladung.",
                xp: 20
            },
            {
                difficulty: 1,
                type: "multiple",
                question: "Wer ist für die Standardisierung von HTML zuständig?",
                options: [
                    "W3C (World Wide Web Consortium)",
                    "Microsoft",
                    "Google",
                    "ISO"
                ],
                correct: 0,
                explanation: "Das W3C (World Wide Web Consortium) ist für die Standardisierung von HTML zuständig.",
                xp: 10
            },
            {
                difficulty: 3,
                type: "multiple",
                question: "Was ist das Ziel von Responsive Web Design?",
                options: [
                    "Automatische Updates",
                    "Optimale Darstellung auf verschiedenen Bildschirmgrößen",
                    "Schnellere Serverantworten",
                    "Bessere Suchmaschinenoptimierung"
                ],
                correct: 1,
                explanation: "Responsive Web Design sorgt für optimale Darstellung und Bedienbarkeit auf verschiedenen Geräten und Bildschirmgrößen.",
                xp: 30
            },
            {
                difficulty: 2,
                type: "fillblank",
                question: "Git wurde 2005 von _____ _____ entwickelt.",
                blanks: ["Linus", "Torvalds"],
                explanation: "Git ist ein Open-Source-Versionskontrollsystem, das 2005 von Linus Torvalds entwickelt wurde.",
                xp: 20
            },
            {
                difficulty: 4,
                type: "multiple",
                question: "Welche Java-Bibliothek wird in Spring Boot Tests für aussagekräftige Assertions verwendet?",
                options: [
                    "Hamcrest",
                    "JUnit Basic",
                    "AssertJ",
                    "Mockito"
                ],
                correct: 2,
                explanation: "AssertJ wird verwendet. Tests werden mit verketteten Methodenaufrufen lesbarer und Fehlermeldungen sind detaillierter als bei Hamcrest.",
                xp: 40
            },
            {
                difficulty: 1,
                type: "multiple",
                question: "Was war der erste Dienst des Internets?",
                options: [
                    "World Wide Web",
                    "E-Mail (1972)",
                    "FTP",
                    "Telnet"
                ],
                correct: 1,
                explanation: "1972 wurde das E-Mail-Protokoll von Ray Tomlinson für das ARPANET entwickelt - der erste Dienst des Internets.",
                xp: 10
            },
            {
                difficulty: 3,
                type: "checkbox",
                question: "Welche Basiskonzepte gehören zum WWW? (Mehrfachauswahl)",
                options: [
                    "Client-Server Architektur",
                    "Peer-to-Peer Netzwerk",
                    "Hypermedia-Inhalte",
                    "URIs (Links)",
                    "Blockchain"
                ],
                correct: [0, 2, 3],
                explanation: "WWW-Basiskonzepte: Client-Server Architektur, Hypermedia-Inhalte, URIs, HTML, HTTP. Peer-to-Peer und Blockchain gehören nicht dazu.",
                xp: 30
            }
        ];

        let currentQuestion = 0;
        let score = 0;
        let userAnswers = [];
        let selectedLevel = null;
        let filteredQuestions = [];
        let xp = 0;
        let level = 1;
        let correctAnswers = 0;
        let wrongAnswers = 0;
        let playerName = "";
        let isSpeedrunMode = false;
        let isPracticeMode = false;
        let speedrunTimer = 0;
        let speedrunInterval = null;
        let sessionLeaderboard = {
            easy: [],
            medium: [],
            hard: [],
            expert: []
        };
        let questionPool = {
            easy: [],
            medium: [],
            hard: [],
            expert: []
        };
        let usedQuestions = new Set();
        let wrongAnsweredQuestions = [];
        let lastFiveRuns = [];
        let startTime = 0;
        let currentTime = 0;
        let timerInterval = null;

        // Level calculations
        function getXPForLevel(lvl) {
            return lvl * 100;
        }

        function checkLevelUp() {
            const requiredXP = getXPForLevel(level);
            if (xp >= requiredXP) {
                level++;
                showLevelUp();
                updateLevelBadge();
            }
        }

        function showLevelUp() {
            const overlay = document.getElementById('levelUpOverlay');
            const message = document.getElementById('levelUpMessage');
            const description = document.getElementById('levelUpDescription');

            message.textContent = `🎉 Level ${level} erreicht!`;
            description.textContent = `Du hast ${getXPForLevel(level)} XP erreicht!`;

            overlay.classList.add('show');
            createConfetti();
        }

        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = ['#667eea', '#764ba2', '#48bb78', '#f56565', '#ffd700'][Math.floor(Math.random() * 5)];
                    document.body.appendChild(confetti);

                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }

        function updateXPDisplay() {
            document.getElementById('xpDisplay').textContent = xp;
        }

        function updateLevelBadge() {
            const badge = document.getElementById('levelBadge');
            const icons = ['🌱', '⚡', '🔥', '💎', '👑'];
            const icon = icons[Math.min(level - 1, icons.length - 1)];
            badge.textContent = `${icon} Level ${level}`;
        }

        function updateBodyClass() {
            document.body.className = '';
            if (selectedLevel === 'easy') document.body.classList.add('level-easy');
            else if (selectedLevel === 'medium') document.body.classList.add('level-medium');
            else if (selectedLevel === 'hard') document.body.classList.add('level-hard');
            else if (selectedLevel === 'expert') document.body.classList.add('level-expert');
        }

        function formatTime(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function updateTimer() {
            if (!isSpeedrunMode) return;
            currentTime = Date.now();
            const elapsed = currentTime - startTime;
            document.getElementById('timer').textContent = formatTime(elapsed);
        }

        function initializeQuestionPool() {
            questionPool = {
                easy: baseQuestions.filter(q => q.difficulty === 1),
                medium: baseQuestions.filter(q => q.difficulty === 2),
                hard: baseQuestions.filter(q => q.difficulty === 3),
                expert: baseQuestions.filter(q => q.difficulty === 4)
            };
        }

        function selectQuestionsFromPool(level, count) {
            // Wenn wir im Vorlesungsmodus sind, gib die Vorlesungsfragen direkt zurück
            if (level === 'vorlesung') {
                return shuffleArray([...vorlesungQuestions]);
            }
            
            // Für andere Modi: Filtere Fragen, die ähnlich zu Vorlesungsfragen sind
            const isVorlesungRelated = (q) => {
                const keywords = ['WWW', 'World Wide Web', 'Internet', 'ARPANET', 'HTTP', 
                                'TCP', 'IP', 'Tim Berners-Lee', 'IMP', 'Interface Message', 
                                'Paketvermittlung', 'Web-Client', 'Web-Server'];
                return keywords.some(keyword => 
                    q.question.includes(keyword) || 
                    (q.explanation && q.explanation.includes(keyword))
                );
            };

            const availableQuestions = questionPool[level]
                .filter(q => !usedQuestions.has(q))
                .filter(q => !isVorlesungRelated(q));  // Hier filtern wir vorlesungsähnliche Fragen

            const selectedQuestions = [];
            
            while (selectedQuestions.length < count && availableQuestions.length > 0) {
                const randomIndex = Math.floor(Math.random() * availableQuestions.length);
                const question = availableQuestions.splice(randomIndex, 1)[0];
                
                // Verwende die Frage OHNE Typ-Änderung (Deep Clone)
                const clonedQuestion = JSON.parse(JSON.stringify(question));
                
                selectedQuestions.push(clonedQuestion);
                usedQuestions.add(question);
            }

            return selectedQuestions;
        }

        function updateLeaderboard(level, score, time = null) {
            const entry = {
                name: playerName,
                score: score,
                time: time,
                xp: xp,
                timestamp: Date.now()
            };

            sessionLeaderboard[level].push(entry);
            sessionLeaderboard[level].sort((a, b) => {
                if (isSpeedrunMode) {
                    return (b.score - a.score) || (a.time - b.time);
                }
                return b.score - a.score;
            });

            // Nur die Top 5 behalten
            sessionLeaderboard[level] = sessionLeaderboard[level].slice(0, 5);
        }

        function displayLeaderboard() {
            const leaderboardContent = document.getElementById('leaderboardContent');
            // pick a sensible current level: selectedLevel, or first level with entries, or 'easy'
            const currentLevel = selectedLevel || Object.keys(sessionLeaderboard).find(k => sessionLeaderboard[k] && sessionLeaderboard[k].length > 0) || 'easy';
            const entries = sessionLeaderboard[currentLevel] || [];
            const tabBtn = document.querySelector('.tab-btn.active');
            const currentMode = tabBtn ? tabBtn.dataset.mode : 'normal';

            const filteredEntries = entries.filter(entry => 
                currentMode === 'speedrun' ? entry.time != null : entry.time == null
            );

            if (filteredEntries.length === 0) {
                leaderboardContent.innerHTML = '<div class="leaderboard-entry" style="justify-content: center; color: #718096;">Noch keine Einträge</div>';
                return;
            }

            leaderboardContent.innerHTML = filteredEntries
                .sort((a, b) => {
                    if (currentMode === 'speedrun') {
                        // Sortiere nach Punktzahl und Zeit im Speedrun-Modus
                        const scoreComp = b.score - a.score;
                        return scoreComp !== 0 ? scoreComp : (a.time || 0) - (b.time || 0);
                    }
                    // Sortiere nur nach Punktzahl im normalen Modus
                    return b.score - a.score;
                })
                .slice(0, 5)
                .map((entry, index) => `
                    <div class="leaderboard-entry">
                        <span class="entry-rank">${index + 1}.</span>
                        <span class="entry-name">${entry.name}</span>
                        <span class="entry-score">${Math.round((entry.score / (filteredQuestions.length || 1)) * 100)}% (${entry.xp} XP)</span>
                        ${entry.time ? `<span class="entry-time">${formatTime(entry.time)}</span>` : ''}
                    </div>
                `).join('');
        }

        function startQuiz() {
            // allow starting when practice mode or vorlesung mode is selected (no level required)
            if (!isPracticeMode && !document.querySelector('.mode-btn[data-mode="vorlesung"].selected') && !selectedLevel) return;

            // Name übernehmen (fallback: "Spieler/in")
            const nameInput = document.getElementById('playerName');
            playerName = (nameInput.value || "Spieler/in").trim();

            initializeQuestionPool();

            if (isPracticeMode) {
                // Übungsmodus: Hole falsch beantwortete Fragen aus den letzten fünf Durchläufen (lastFiveRuns)
                // lastFiveRuns ist ein Array von Arrays (je Lauf: falsch beantwortete Fragen als Frage-Objekte)
                const combined = lastFiveRuns.flat();

                // dedupliziere nach question-Text (falls vorhanden), sonst per JSON-String
                const uniqueMap = new Map();
                combined.forEach(q => {
                    const key = q && q.question ? q.question : JSON.stringify(q);
                    if (!uniqueMap.has(key)) uniqueMap.set(key, q);
                });

                const recentWrongQuestions = Array.from(uniqueMap.values());

                if (recentWrongQuestions.length === 0) {
                    alert('Keine falsch beantworteten Fragen aus den letzten Durchläufen verfügbar. Wechsel zum normalen Modus.');
                    isPracticeMode = false;
                    const normalModeBtn = document.querySelector('.mode-btn[data-mode="normal"]');
                    normalModeBtn.click();
                    return;
                }

                filteredQuestions = shuffleArray(recentWrongQuestions)
                    .slice(0, Math.min(10, recentWrongQuestions.length));

            } else if (selectedLevel === 'vorlesung') {
                // Vorlesungsmodus: Verwende die vordefinierten Vorlesungsfragen
                filteredQuestions = [...vorlesungQuestions];
            } else if (isSpeedrunMode) {
                // Im Speedrun-Modus: Zufällige Fragen aus allen Schwierigkeitsgraden
                const questionCounts = { easy: 5, medium: 5, hard: 5, expert: 5 };
                filteredQuestions = [];
                Object.entries(questionCounts).forEach(([level, count]) => {
                    filteredQuestions = filteredQuestions.concat(selectQuestionsFromPool(level, count));
                });
                filteredQuestions = filteredQuestions.sort(() => Math.random() - 0.5);

                // Timer starten
                startTime = Date.now();
                document.getElementById('timerDisplay').style.display = 'block';
                timerInterval = setInterval(updateTimer, 1000);
            } else {
                // Normaler Modus: Fragen nach Schwierigkeitsgrad filtern
                const difficultyMap = { easy: 1, medium: 2, hard: 3, expert: 4 };
                const maxDifficulty = difficultyMap[selectedLevel];
                filteredQuestions = selectQuestionsFromPool(selectedLevel, 10);
            }

            document.getElementById('startScreen').style.display = 'none';
            updateBodyClass();
            renderQuestion();
        }

        function renderQuestion() {
            const container = document.getElementById('questionsContainer');
            const question = filteredQuestions[currentQuestion];

            let optionsHTML = '';
            const letters = ['A', 'B', 'C', 'D', 'E', 'F'];

            if (question.type === 'multiple') {
                optionsHTML = question.options.map((option, index) => `
                    <div class="option" data-index="${index}" data-letter="${letters[index]}">
                        <span>${option}</span>
                    </div>
                `).join('');

            } else if (question.type === 'checkbox') {
                optionsHTML = question.options.map((option, index) => `
                    <div class="option">
                        <input type="checkbox" id="option${index}">
                        <label for="option${index}" style="cursor: pointer; flex: 1;">${option}</label>
                    </div>
                `).join('');

            } else if (question.type === 'text') {
                optionsHTML = `<input type="text" class="text-input" id="textAnswer" placeholder="Deine Antwort eingeben...">`;

            } else if (question.type === 'fillblank') {
                let questionText = question.question;
                (question.blanks || []).forEach((_, i) => {
                    questionText = questionText.replace('_____', `<input type="text" class="blank-input" id="blank${i}" placeholder="...">`);
                });
                optionsHTML = `<div style="font-size: 18px; line-height: 2;">${questionText}</div>`;

            } else if (question.type === 'sort') {
                // Sort: zeige nur die sortierbaren Items (keine Matching-Spalten hier)
                const itemsToShow = shuffleArray([...question.items || []]);
                optionsHTML = `<div class="sortable-container" id="sortableContainer">
                    ${itemsToShow.map((item) => `
                        <div class="sortable-item" draggable="true" data-item="${item}">
                            <span class="drag-handle">☰</span>
                            <span>${item}</span>
                        </div>
                    `).join('')}
                </div>`;

            } else if (question.type === 'matching') {
                // Matching: benutze question.left / question.right wenn vorhanden, sonst paare aufteilen
                const leftItems = question.left || (question.pairs || []).map(p => p.left);
                const rightItems = question.right || (question.pairs || []).map(p => p.right);

                optionsHTML = `
                    <div class="matching-container">
                        <div class="matching-column" id="leftColumn">
                            ${leftItems.map((item) => `
                                <div class="matching-item" data-value="${item}" data-side="left">
                                    ${item}
                                </div>
                            `).join('')}
                        </div>
                        <div class="matching-column" id="rightColumn">
                            ${rightItems.map((item) => `
                                <div class="matching-item" data-value="${item}" data-side="right">
                                    ${item}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div id="matchingPairs" style="margin-top: 20px; display: none;"></div>
                `;
            }

            const difficultyDots = Array(4).fill(0).map((_, i) =>
                `<div class="difficulty-dot ${i < (question.difficulty || 1) ? 'active' : ''}"></div>`
            ).join('');

            container.innerHTML = `
                <div class="question-container active">
                    <div class="question-header">
                        <span class="question-number">Frage ${currentQuestion + 1}/${filteredQuestions.length}</span>
                        <div class="difficulty-indicator">${difficultyDots}</div>
                    </div>
                    <div class="question-text">${(question.question || 'Bitte ordne die Elemente zu.')}</div>
                    <div class="options" id="optionsContainer">
                        ${optionsHTML}
                    </div>
                    <div class="feedback" id="feedback"></div>
                    <div class="buttons">
                        ${currentQuestion > 0 ? '<button class="btn btn-secondary" id="prevBtn">← Zurück</button>' : ''}
                        <button class="btn btn-primary" id="checkBtn">Prüfen</button>
                    </div>
                </div>
            `;

            updateProgress();
            attachEventListeners();
        }

        function showWarning(msg) {
            const feedback = document.getElementById('feedback');
            feedback.className = 'feedback warning show';
            feedback.innerHTML = `<strong>⚠ Hinweis:</strong> ${msg}`;
        }

        function attachEventListeners() {
            if (!filteredQuestions || currentQuestion >= filteredQuestions.length) {
                console.error('Keine Fragen verfügbar oder ungültiger Index');
                return;
            }
            
            const question = filteredQuestions[currentQuestion];

            if (question.type === 'multiple') {
                document.querySelectorAll('.option').forEach(option => {
                    option.addEventListener('click', function() {
                        selectOption(parseInt(this.dataset.index));
                    });
                });
            }

            if (question.type === 'sort') {
                const container = document.getElementById('sortableContainer');
                const items = container.querySelectorAll('.sortable-item');

                items.forEach(item => {
                    item.addEventListener('dragstart', handleDragStart);
                    item.addEventListener('dragover', handleDragOver);
                    item.addEventListener('drop', handleDrop);
                    item.addEventListener('dragend', handleDragEnd);
                });
            }

            if (question.type === 'matching') {
                let selectedLeft = null;
                let selectedRight = null;
                const pairs = [];

                document.querySelectorAll('.matching-item').forEach(item => {
                    item.addEventListener('click', function() {
                        if (this.dataset.side === 'left') {
                            document.querySelectorAll('[data-side="left"]').forEach(i => i.classList.remove('selected'));
                            this.classList.add('selected');
                            selectedLeft = this.dataset.value;
                        } else {
                            document.querySelectorAll('[data-side="right"]').forEach(i => i.classList.remove('selected'));
                            this.classList.add('selected');
                            selectedRight = this.dataset.value;
                        }

                        if (selectedLeft && selectedRight) {
                            pairs.push({ left: selectedLeft, right: selectedRight });
                            document.querySelectorAll('.matching-item.selected').forEach(i => {
                                i.style.opacity = '0.3';
                                i.style.pointerEvents = 'none';
                            });
                            selectedLeft = null;
                            selectedRight = null;
                        }

                        // Store pairs for checking
                        window.matchingPairs = pairs;
                    });
                });
            }

            const checkAnswerBtn = document.getElementById('checkBtn');
            if (checkAnswerBtn) {
                checkAnswerBtn.addEventListener('click', checkAnswer);
            }

            const prevBtn = document.getElementById('prevBtn');
            if (prevBtn) {
                prevBtn.addEventListener('click', previousQuestion);
            }
        }

        let draggedItem = null;

        function handleDragStart(e) {
            draggedItem = this;
            this.classList.add('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            if (this !== draggedItem) {
                const container = document.getElementById('sortableContainer');
                const items = Array.from(container.children);
                const draggedIndex = items.indexOf(draggedItem);
                const targetIndex = items.indexOf(this);

                if (draggedIndex < targetIndex) {
                    this.parentNode.insertBefore(draggedItem, this.nextSibling);
                } else {
                    this.parentNode.insertBefore(draggedItem, this);
                }
            }
        }

        function handleDragEnd() {
            this.classList.remove('dragging');
        }

        function selectOption(index) {
            const question = filteredQuestions[currentQuestion];
            if (question.type !== 'multiple') return;

            const options = document.querySelectorAll('.option');
            options.forEach((opt, i) => {
                opt.classList.remove('selected');
                if (i === index) {
                    opt.classList.add('selected');
                }
            });
        }

        function checkAnswer() {
            const question = filteredQuestions[currentQuestion];
            const feedback = document.getElementById('feedback');
            let isCorrect = false;
            
            // Deaktiviere den Button während der Prüfung
            const checkButton = document.getElementById('checkBtn');
            if (checkButton) {
                checkButton.disabled = true;
            }

            if (question.type === 'multiple') {
                const selected = document.querySelector('.option.selected');
                if (!selected) {
                    showWarning('Bitte wähle eine Antwort aus!');
                    return;
                }

                const selectedIndex = parseInt(selected.dataset.index);
                isCorrect = selectedIndex === question.correct;

                const options = document.querySelectorAll('.option');
                options.forEach((opt, i) => {
                    if (i === question.correct) {
                        opt.classList.add('correct');
                    } else if (i === selectedIndex && !isCorrect) {
                        opt.classList.add('wrong');
                    }
                    opt.style.pointerEvents = 'none';
                });

            } else if (question.type === 'checkbox') {
                const checkboxes = document.querySelectorAll('input[type="checkbox"]');
                const selected = [];
                checkboxes.forEach((cb, i) => {
                    if (cb.checked) selected.push(i);
                });

                if (selected.length === 0) {
                    showWarning('Bitte wähle mindestens eine Antwort aus!');
                    return;
                }

                isCorrect = selected.length === question.correct.length &&
                           selected.every(i => question.correct.includes(i));

                const options = document.querySelectorAll('.option');
                options.forEach((opt, i) => {
                    const isCorrectAnswer = question.correct.includes(i);
                    const isSelected = selected.includes(i);

                    if (isCorrectAnswer) {
                        opt.classList.add('correct');
                    } else if (isSelected) {
                        opt.classList.add('wrong');
                    }
                });

                checkboxes.forEach(cb => cb.disabled = true);

            } else if (question.type === 'text') {
                const answer = document.getElementById('textAnswer').value.trim().toLowerCase();
                if (!answer) {
                    showWarning('Bitte gib eine Antwort ein!');
                    return;
                }

                isCorrect = question.correct.some(correct =>
                    answer.includes(correct.toLowerCase())
                );

                const textInput = document.getElementById('textAnswer');
                textInput.style.borderColor = isCorrect ? '#48bb78' : '#f56565';
                textInput.disabled = true;
            } else if (question.type === 'fillblank') {
                const blanks = question.blanks;
                const answers = blanks.map((_, i) => {
                    const input = document.getElementById(`blank${i}`);
                    return input ? input.value.trim() : '';
                });

                if (answers.some(a => !a)) {
                    showWarning('Bitte fülle alle Lücken aus!');
                    return;
                }

                isCorrect = answers.every((answer, i) =>
                    answer.toLowerCase() === blanks[i].toLowerCase()
                );

                answers.forEach((_, i) => {
                    const input = document.getElementById(`blank${i}`);
                    if (input) {
                        const right = input.value.trim().toLowerCase() === blanks[i].toLowerCase();
                        input.style.borderColor = right ? '#48bb78' : '#f56565';
                        input.disabled = true;
                    }
                });
            } else if (question.type === 'sort') {
                const container = document.getElementById('sortableContainer');
                const items = Array.from(container.children);
                const userOrder = items.map(item => item.dataset.item);

                isCorrect = JSON.stringify(userOrder) === JSON.stringify(question.correct);

                items.forEach((item, i) => {
                    item.draggable = false;
                    if (item.dataset.item === question.correct[i]) {
                        item.classList.add('correct');
                    } else {
                        item.classList.add('wrong');
                    }
                });
            } else if (question.type === 'matching') {
                const userPairs = window.matchingPairs || [];

                if (userPairs.length !== question.pairs.length) {
                    showWarning('Bitte ordne alle Paare zu!');
                    return;
                }

                isCorrect = userPairs.every(userPair =>
                    question.pairs.some(correctPair =>
                        correctPair.left === userPair.left && correctPair.right === userPair.right
                    )
                );

                document.querySelectorAll('.matching-item').forEach(item => {
                    item.style.pointerEvents = 'none';
                });
            }

            if (isCorrect) {
                score++;
                correctAnswers++;
                let gainedXP = question.xp;
                // Bonus XP im Speedrun-Modus
                if (isSpeedrunMode) {
                    gainedXP = Math.floor(gainedXP * 1.5); // 50% mehr XP im Speedrun
                }
                xp += gainedXP;
                updateXPDisplay();
                checkLevelUp();
                feedback.className = 'feedback correct show';
                feedback.innerHTML = `<strong>✓ Richtig!</strong> <span class="xp-gain">+${gainedXP} XP</span><br>${question.explanation}`;
            } else {
                wrongAnswers++;
                let xpPenalty = 0;
                // XP-Bestrafung bei mittlerem und höherem Schwierigkeitsgrad
                if (question.difficulty >= 2 || isSpeedrunMode) {
                    xpPenalty = Math.floor(question.xp * (isSpeedrunMode ? 0.75 : 0.5));
                    xp = Math.max(0, xp - xpPenalty);
                    updateXPDisplay();
                }

                // Speichere falsch beantwortete Frage
                if (!isPracticeMode) {
                    wrongAnsweredQuestions.push({
                        question: question,
                        timestamp: Date.now()
                    });
                    // Behalte nur die letzten 50 falsch beantworteten Fragen
                    if (wrongAnsweredQuestions.length > 50) {
                        wrongAnsweredQuestions.shift();
                    }
                }

                feedback.className = 'feedback wrong show';
                feedback.innerHTML = `<strong>✗ Leider falsch.</strong>${xpPenalty > 0 ? ` <span class="xp-gain" style="background: #f56565">-${xpPenalty} XP</span>` : ''}<br>${question.explanation}`;
            }

            userAnswers[currentQuestion] = isCorrect;

            const nextBtn = document.getElementById('checkBtn');
            if (nextBtn) {
                nextBtn.textContent = currentQuestion === filteredQuestions.length - 1 ? 'Ergebnis anzeigen' : 'Weiter →';
                const newNextBtn = nextBtn.cloneNode(true);
                nextBtn.parentNode.replaceChild(newNextBtn, nextBtn);
                newNextBtn.addEventListener('click', nextQuestion);
            }
        }

        function nextQuestion() {
            currentQuestion++;

            if (currentQuestion >= filteredQuestions.length) {
                showResults();
            } else {
                renderQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
            }
        }

        function showResults() {
            const percentage = Math.round((score / filteredQuestions.length) * 100);
            const resultScreen = document.getElementById('resultScreen');
            const questionsContainer = document.getElementById('questionsContainer');

            if (isSpeedrunMode) {
                clearInterval(timerInterval);
                currentTime = Date.now();
            }

            questionsContainer.style.display = 'none';
            resultScreen.classList.add('show');

            document.getElementById('scoreText').textContent = percentage + '%';

            let message = '';
            if (percentage >= 90) {
                message = '🎉 Hervorragend!';
            } else if (percentage >= 75) {
                message = '👍 Sehr gut!';
            } else if (percentage >= 60) {
                message = '✓ Gut gemacht!';
            } else if (percentage >= 50) {
                message = '📚 Weiter üben!';
            } else {
                message = '💪 Nicht aufgeben!';
            }

            // Name dynamisch einbauen
            document.getElementById('resultMessage').textContent = playerName + ': ' + message;
            
            let detailsText = `Du hast ${score} von ${filteredQuestions.length} Fragen richtig beantwortet.`;
            const leaderboardLevel = selectedLevel || 'easy';
            if (isSpeedrunMode) {
                const elapsedTime = currentTime - startTime;
                detailsText += `\nBenötigte Zeit: ${formatTime(elapsedTime)}`;
                updateLeaderboard(leaderboardLevel, score, elapsedTime);
            } else {
                updateLeaderboard(leaderboardLevel, score);
            }
            document.getElementById('resultDetails').textContent = detailsText;

            document.getElementById('statCorrect').textContent = correctAnswers;
            document.getElementById('statWrong').textContent = wrongAnswers;
            document.getElementById('statXP').textContent = xp;
            document.getElementById('statLevel').textContent = level;

            // Speichere falsch beantwortete Fragen dieses Durchlaufs in lastFiveRuns (für Übungsmodus)
            try {
                const currentRunWrong = filteredQuestions
                    .map((q, i) => ({ q: q, idx: i }))
                    .filter(item => userAnswers[item.idx] === false)
                    .map(item => JSON.parse(JSON.stringify(item.q))); // deep clone

                lastFiveRuns.push(currentRunWrong);
                if (lastFiveRuns.length > 5) lastFiveRuns.shift();
            } catch (e) {
                // Falls etwas schiefgeht, nicht blockieren (robuster gegen undefiniertheiten)
                console.warn('Konnte lastFiveRuns nicht aktualisieren:', e);
            }

            // updateLeaderboard() was already called with level/time above; avoid empty call
            displayLeaderboard();

            // WhatsApp Share Link erzeugen (Text dynamisch)
            const shareText = encodeURIComponent(
                `${playerName} hat gerade ${percentage}% im Quiz "Web-basierte Anwendungssysteme" erreicht.\n` +
                `Level ${level}, ${xp} XP.\n` +
                `Willst du es auch spielen? Frag mich nach der HTML-Datei oder nimm den Link 👇`
            );

            const waUrl = `https://wa.me/?text=${shareText}`;

            const waBtn = document.getElementById('whatsappShareBtn');
            waBtn.setAttribute('href', waUrl);
        }

        function restartQuiz() {
            currentQuestion = 0;
            score = 0;
            userAnswers = [];
            correctAnswers = 0;
            wrongAnswers = 0;
            xp = 0;
            level = 1;
            selectedLevel = null;
            playerName = "";
            
            // Reset Timer und Speedrun-Modus
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            document.getElementById('timerDisplay').style.display = 'none';
            isSpeedrunMode = false;

            document.getElementById('resultScreen').classList.remove('show');
            document.getElementById('questionsContainer').style.display = 'block';
            document.getElementById('startScreen').style.display = 'block';
            document.body.className = '';

            updateXPDisplay();
            updateLevelBadge();

            // Reset Level Auswahl
            document.querySelectorAll('.level-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Reset Mode Auswahl
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector('.mode-btn[data-mode="normal"]').classList.add('selected');

            document.getElementById('startBtn').disabled = true;
            
            // Reset Question Pool und Timer
            usedQuestions.clear();
            document.getElementById('timer').textContent = '00:00';
            
            // Reset player name input
            document.getElementById('playerName').value = '';
            
            // Validate start conditions
            validateStartConditions();
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / filteredQuestions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            // Level selection
            document.querySelectorAll('.level-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.level-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedLevel = this.dataset.level;
                    validateStartConditions();
                });
            });

            // Mode selection (sets speedrun / practice flags and updates UI)
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    const mode = this.dataset.mode;
                    isSpeedrunMode = mode === 'speedrun';
                    isPracticeMode = mode === 'practice';

                    // show/hide practice info
                    const practiceInfo = document.getElementById('practiceInfo');
                    if (practiceInfo) practiceInfo.style.display = isPracticeMode ? 'block' : 'none';

                    // disable level selection in practice mode
                    document.querySelectorAll('.level-card').forEach(card => {
                        card.style.pointerEvents = isPracticeMode ? 'none' : 'auto';
                        card.style.opacity = isPracticeMode ? '0.6' : '1';
                    });

                    validateStartConditions();
                });
            });

            // Name input validation
            document.getElementById('playerName').addEventListener('input', validateStartConditions);

        function validateStartConditions() {
            const nameInput = document.getElementById('playerName');
            const startBtn = document.getElementById('startBtn');
            const nameOk = !!nameInput.value.trim();
            const vorlesungMode = document.querySelector('.mode-btn[data-mode="vorlesung"].selected');
            
            // Erlaube Start wenn:
            // - Name eingegeben UND
            // - (Übungsmodus ODER Level ausgewählt ODER Vorlesungsmodus)
            startBtn.disabled = !(nameOk && (isPracticeMode || selectedLevel || vorlesungMode));
            
            // Visuelle Feedback für den User
            if (!nameOk) {
                nameInput.style.borderColor = 'rgba(231, 76, 60, 0.5)';  // Rötlich für Fehler
            } else {
                nameInput.style.borderColor = 'rgba(46, 204, 113, 0.5)';  // Grünlich für OK
            }
        }            // (removed duplicate mode selection handler)

            const quizStartBtn = document.getElementById('startBtn');
            if (quizStartBtn) {
                quizStartBtn.addEventListener('click', startQuiz);
            }

            const quizRestartBtn = document.getElementById('restartBtn');
            if (quizRestartBtn) {
                quizRestartBtn.addEventListener('click', restartQuiz);
            }

            const levelUpContinue = document.getElementById('levelUpContinue');
            if (levelUpContinue) {
                levelUpContinue.addEventListener('click', function() {
                    document.getElementById('levelUpOverlay').classList.remove('show');
                });
            }

            // Leaderboard Tab-Wechsel
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    displayLeaderboard();
                });
            });

            updateProgress();
            updateXPDisplay();
            updateLevelBadge();
        });
    </script>
</body>
</html>
